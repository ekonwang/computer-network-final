# 第一章 概述

## 网络应用模型

#### C/S 模型 (客户-服务器模型)

服务器: **提供计算服务**的设备

1. 永久提供服务
2. 永久性访问地址/域名

客户机: **请求计算服务的主机**

1. 与服务器通信, 使用服务器提供的服务
2. 间歇性接入网络
3. 可能使用动态 IP 地址cc
4. 不与其他客户机直接通信

C/S 模型的常见应用: Web, 文件传输FTP, 远程登录, 电子邮件

#### B/S 模型 (浏览器-服务器模型)

*与C/S模型不同, B/S模型采用的范式是瘦客户机+胖服务器模型, 客户机比较简单, 没有专用的客户软件, 也比较容易维护. 一个比较好的例子是页游.*

#### P2P 模型

1. 不存在永远在线的服务器
2. 每个主机既可以提供服务, 也可以请求服务
3. 任意端系统/节点之间可以直接通讯
4. 节点间歇性接入网络
5. 节点可能改变 IP 地址
6. 可拓展性更好

![img](https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/%E6%88%AA%E5%B1%8F2022-01-05%20%E4%B8%8B%E5%8D%8810.49.36.png)

> 在P2P 模型中, 接入节点越多, 响应的效率越高, 同时P2P模型拥有更大的健壮性. 应用: 迅雷的P2P加速服务

### 资源子网 & 通信子网

前者: 提供信息应用服务, 即**<u>资源访问</u>**服务. 

后者: 负责计算机之间的数据通信, 即<u>**传输**</u>服务.

### 计算机网络的分类

- 按照拓扑结构, 如不规则网型, 星型, 总线型以及环型.
- 按照传输媒体, 比如光纤网
- 按照地理位置, 比如局域网, 校园网, 城域网和广域网, 乃至Internet.

### 计算机网络的度量

- 速率(Rate)

  - 别名：数据率/比特率/位率
  - 含义：在通信线路上传输数据的速率(**传输的基本单位是比特**)
  - 单位：bps(b/s) = $10^{-3}$ Kbps = $10^{-6}$Mbps = $10^{-9}$Gbps = $10^{-12}$Tbps

- 带宽(Bandwidth)

  - 含义：网络通信线路所能传送数据的能力

  - 单位：bps

    > 频带越宽，速率就会越高。因此，宽带代表高速

- 吞吐量/吞吐率(Throughput)

  - 含义：在**单位时间**内通过某个网络/信道/设备/端口的**数据量**
  - 单位：bps 或 **每秒**传送的**字节**数/**帧**数

- 延迟(Delay)

  - **传输**延迟：

    - 含义：因为网络**数据传输速率**的限制而需花费的时间
    - 公式：$\frac{要传输的数据量}{网络数据传输速率}$

  - **传播**延迟：

    - 含义：信号在信道中传播一定的距离需花费的时间
    - 公式：$\frac{信道长度}{信号传播速率}$

  - 延迟 = 传输延迟 + 传播延迟 + 处理延迟

    > 想象水龙头流水：
    >
    > - 传播延迟：最前面的水流到桶底的时间
    > - 传输延迟：之后水流进桶是线性增加的。这个线性增加累计到总量的时间就是传输延迟

- 延迟×带宽

  - 若发送端连续发送数据，则在发送的**第一个**比特即将到达终点时，发送端就**已经发送的数据量**
  - 也代表**线路的暂存容量**

- 往返时间(RTT)

  - 从发送方**发送数据**，到发送方**收到**来自接收方的**确认**，**总共经历的时间**

- 利用率

  - 信道利用率：在一段时间内信道被利用时间的百分比

    > 并非越高越好。一般不应超过50%



## 数据交换方式

- 电路交换 
- 报文交换 
- 分组交换 

### 电路交换

***基本过程：***

1. 建立连接
2. 通信
3. 拆除连接

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/网络层-电路交换.png" style="zoom:25%;" />

链路上数据具有突发性的特征。为了提高链路的通信效率，可以使用多路复用的技术如 FDM, TDM, WDM 以及 CDM。

***优点***

1. 通信时延小
2. 有序传输
3. 没有冲突
4. 实时性比较强

***缺点***

1. 建立连接的代价比较高
2. 线路独占，使用效率比较低
3. 灵活性比较差 
4. 没有差错控制能力

> 灵活性差的解释：某个交换设备出问题对电路交换的影响比较大，可能导致数条电路无法正常通信。

### 报文交换

***概述***

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/报文交换.png" style="zoom:25%;" />

***优点***

1. 无需建立连接
2. 储存转发，动态分配线路
3. 线路可靠性比较高
4. 线路利用率比较高
5. 多目标服务 （可以传输到多个目的位置）

***缺点***

1. 有储存转发时延
2. 报文大小不确定，需要网络设备有较大缓存空间

### 分组交换

分组：把数据块分割成小的数据块。

两种实现路径：

1. 数据包方式
2. 虚电路方式

***优点***

- 报文交换具有的所有优点
- 储存管理相较于报文交换更为容易

***缺点***

1. 储存转发时延
2. 额外信息需要传输
3. 乱序到达目的主机时，需要对分组排序重组

> 计算时延：从发送方发送第一个比特到最后一个比特到达接受者的时间。
>
> 通常来说，分组交换在理想条件下有更优的效率。

### 不同交换方式的比较

<img src="https://pic.imgdb.cn/item/61d7ff092ab3f51d91087ab4.png" style="zoom:45%;" />

|       比较项       |       内容       |
| :----------------: | :--------------: |
|     链路利用率     | 电路＜报文＜分组 |
|      头部开销      | 电路＜报文＜分组 |
| 长连续报文——总延迟 | 电路＜分组＜报文 |
| 短突发负载——总延迟 | 分组＜报文＜电路 |

> 报文交换和分组交换都采取储存转发。
>
> 网络流量有突发性的特征, 使用分组交换总体上是最优的.

### 网络的分层

#### 为什么要分层?

- 分治: 将一个比较复杂的问题分解成若干个容易处理的, 相对独立的**子问题**, 其中用到的**模块化**思想在工程设计中是很好的思路.
- 把一个复杂的系统分解成多个可管理、好研究、相对独立的层次.
  - 通过接口透明地使用下层的服务, 便于**实现和维护**
  - 灵活, 易于**交流、 理解和标准化**

#### 层次模型的封装 *

![](https://pic.imgdb.cn/item/61d812992ab3f51d911ef36d.png)

**封装**流程：

- 每一层从**高层**接收数据(SDU)
- 添加**头部信息**封装成新的数据单元(PDU)
- 把新的数据单元通过服务接口传递给更低层

**解封装**流程：

- 每层可能会有多个协议，这些协议通过SAP**复用底层提供的服务**
- 每一层从底层接收到数据后，剥离该层协议所添加的头部，同时根据该头部给出的**解复用关键字**将解封装后的数据单元**交给更高层**。

#### OSI 七层网络模型

![](https://pic.imgdb.cn/item/61d8151e2ab3f51d9120daf1.png)

**自顶向下**介绍各层基本功能：

|    层次    |                           主要功能                           |
| :--------: | :----------------------------------------------------------: |
|   应用层   | 使**应用程序**能够在**不同计算机**的**网络应用服务**之间**传递信息** |
|   表示层   |             处理**数据表示形式**或**代码的变换**             |
|   会话层   |                  建立、管理、维持、协调会话                  |
|   运输层   |     负责**数据正确有效**地从一端运输到另一端(端到端服务)     |
|   网络层   |    决定通信子网中或通信子网间**分组传递**的路径(网际互连)    |
| 数据链路层 |     数据**检错与纠错**以及数据**链路的维护**(数据块传输)     |
|   物理层   |             在物理媒体上传输原始的数据比特流信号             |

#### Internet 四层模型

<img src="https://pic.imgdb.cn/item/61d819072ab3f51d91240831.png" style="zoom:70%;" />

#### 网络标准化组织

太多了, 知道了也没什么用, 不会考.



# 应用层

## 应用层概述

*应用层对应用程序的通信提供服务.*

**应用层协议应当定义?**

- 应用进程交换的报文类型, 请求还是响应 ?

- 各种报文类型的语法, 如报文中各个字段及其详细描述.
- 字段的含义, 即包含在字段中信息的含义.
- 进程何时、如何发送报文, 以及对报文进行响应的规则.

**应用层的功能?**

- 文件传输、访问和管理
- 电子邮件
- 虚拟终端
- 查询服务和远程作业登录

## DNS 协议

人们不会记忆 IP 地址, 因此需要域名系统方便人们访问网站.

DNS 协议提供域名 $\rightarrow$ IP 的映射查询机制 (域名解析服务)

**域名**

域名分级, 比如 www.fudan.edu.cn 从右向左依次重要度下降, cn 是一级域名, www 是四级域名.

**域名服务器**

- 跟域名服务器
- 顶级域名服务器
- 权限域名服务器
- 本地域名服务器

当一个主机发出 DNS 查询请求, 这个查询请求报文就发送给本地域名服务器.

***分层次域名服务器***

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-05 下午11.13.54.png" style="zoom:27%;" />

### 域名解析过程

#### 递归查询

如果本地域名服务器没有相应内容, 本地域名服务器就查询根域名服务器;

如果根域名服务器没有缓存, 就查询顶级域名服务器;

递归地, 如果顶级域名服务器没有缓存, 就查询权限域名服务器

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-05 下午11.20.48.png" style="zoom:33%;" />

#### 迭代查询

查询一直由一台主机/服务器发起.

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-05 下午11.22.00.png" style="zoom:33%;" />

- 服务器维护高速缓存
- 不光服务器维护高速缓存, 主机本身也会维护解析缓存

## FTP 协议

- 登录 FTP 地址 1) 用户名 + 密码 2) *匿名登录*

- 使用 <u>**TCP 协议 **</u> 实现可靠传输

FTP 服务器维护多个服务器进程, 包括一个主进程和 n 个从属进程.

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.33.59.png" style="zoom:33%;" />

控制连接相当于传送文件之前的准备流程, 传输指令, 在会话过程中始终保持

正式传输数据之前会初始化一个数据连接, 文件传输完就可以关闭

**主动传输**

采用 TCP 20 端口

**被动传输**

被动方式由服务器和客户端自行协商决定 (端口号 > 1024)

## 电子邮件 

*电子邮件系统*

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.45.24.png" style="zoom:33%;" />

- 发送客户通过用户代理发送邮件
- 邮件缓存在发送方邮件服务器
- 发送方邮件服务器把邮件缓存发送到接收方邮件服务器
- 接收方通过用户代理读取邮件

> 客户代理就是指客户所用的软件

### SMTP 协议

SMTP 规定了在两个相互通信的 <u>SMTP 进程</u>之间应如何交换信息. 

负责发送邮件的 SMTP 进程就是 SMTP 客户, 负责接收邮件的进程就是 SMTP 服务器.

SMTP 规定了 14 条命令和 21 种应答信息 (三位数字代码+简单文字说明)

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.52.20.png" style="zoom:25%;" />

**大致过程**

1. 连接建立

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.54.17.png" style="zoom:33%;" />

2. 邮件发送

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.56.22.png" style="zoom:33%;" />

3. 邮件释放阶段

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.57.05.png" style="zoom:33%;" />

**缺点** 

只支持 ASCII 码.

**解决方法**

MIME 通用因特网邮件扩充, 将非ASCII码数据转换成 ASCII 码文件, 代价是更低的编码效率. 

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午3.59.13.png" style="zoom:33%;" />

### POP3 协议

在 POP3 协议中, 服务端是接收端邮件服务器, 客户端是客户代理.

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午4.02.35.png" style="zoom:33%;" />

## 万维网 & HTTPS

万维网是一个大规模的、联机式的信息储藏所/资料空间, 是一个无数个网络站点和网页的集合.

<u>**URL**</u> 统一资源定位符, 用于唯一标识网络资源.

用户通过点击超链接 比如 [https://www.google.com](https://www.google.com) 获取网络资源, 这些资源通过 HTTP 或者 HTTPS 协议传送给使用者.

万维网以**<u>客户/服务器</u>**方式工作, 用户使用的浏览器就是万维网客户程序, 万维网文档所驻留的主机运行服务器程序.

万维网使用**<u>超文本标记语言 (HTML)</u>**, 使得万维网页面设计者可以很方便地从一个界面的链接转到另一个界面, 并能在自己的屏幕上显示出来.

### HTTP 协议

HTTP 定义了浏览器 (或者其他万维网客户进程) 怎么样向万维网服务器请求万维网文档, 以及服务器怎么样把文档传送给浏览器.

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午4.16.46.png" style="zoom:33%;" />

具体而言:

1. 浏览器解析URL
2. 浏览器向 DNS 请求解析 IP 地址
3. DNS 解析出 IP 地址
4. 浏览器与服务器建立 TCP 连接
5. 浏览器发送取文件命令
6. 服务器响应
7. 释放 TCP 连接
8. 浏览器显示

#### HTTP 特点

- HTTP 协议是无状态的, 但在实际工作中, 一些万维网站点常常希望能够识别用户. 方案就是 <u>cookie</u>, 它方便站点识别用户.
- HTTP 协议采用 TCP 连接作为运输协议, 但 HTTP 协议本身是无连接的.

##### 非持久连接

HTTP 报文和 TCP 确认可以一起发送, 每次资源请求需要**两个**RTT

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午4.24.12.png" style="zoom:35%;" />

##### 持久连接

###### 非流水线

除了第一个请求需要2*RTT时间, 后面的报文请求都只需要1个RTT时间.

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午4.25.43.png" style="zoom:33%;" />

###### 流水线

类似于SR与停等协议之间的区别, 第二个RTT开始可以并行式地发送请求, 因此所有请求用2*RTT 就够了.

#### HTTP 报文结构

HTTP 报文包括请求报文、响应报文. 

HTTP 报文**<u>面向文本</u>**, 因此在报文中的每一个字段都是一些 ASCII 码串.

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午4.30.20.png" style="zoom:33%;" />

某浏览器发送的请求报文

<img src="https://cdn.jsdelivr.net/gh/ekonwang/images@master/img/截屏2022-01-06 下午4.30.58.png" style="zoom:33%;" />

**状态码的分类(5🀄️), 实际上有31种状态码**

1. 1xx表示通知, 如请求收到或正在处理
2. 2xx表示成功
3. 3xx表示重定向
4. 4xx表示客户差错, 比如请求中有语法错误
5. 5xx表示服务器差错, 如服务器失效无法完成请求

